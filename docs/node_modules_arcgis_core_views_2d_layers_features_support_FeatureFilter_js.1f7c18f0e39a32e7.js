"use strict";(self.webpackChunkdemo2=self.webpackChunkdemo2||[]).push([["node_modules_arcgis_core_views_2d_layers_features_support_FeatureFilter_js"],{53023:(Q,N,i)=>{i.d(N,{hN:()=>K,P0:()=>C,cW:()=>_});var U=i(15861),Z=i(26584),A=i(33190),W=i(11519),v=i(91179),O=i(37053);function R(s,n){return s?n?4:3:n?3:2}function m(s,n,E,P,t){if(!s)return!1;const r=R(n,E),{coords:l,lengths:h}=s;let u=!1,p=0;for(const g of h)u=I(u,l,r,p,g,P,t),p+=g*r;return u}function I(s,n,E,P,t,r,l){let h=s,u=P;for(let p=P,g=P+t*E;p<g;p+=E){u=p+E,u===g&&(u=P);const f=n[p],x=n[p+1],z=n[u],b=n[u+1];(x<l&&b>=l||b<l&&x>=l)&&f+(l-x)/(b-x)*(z-f)<r&&(h=!h)}return h}var T=i(82054),G=i(88071),M=i(82959),B=i(6185);const j="feature-store:unsupported-query",L={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},V_spatialRelationship={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},V_queryGeometry={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},V_layerGeometry={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function D(s){return!0===V_spatialRelationship[s]}function e(s){return!0===V_queryGeometry[(0,v.Ji)(s)]}function o(s){return!0===V_layerGeometry[s]}function _(s,n,E,P,t){if((0,v.oU)(n)&&"esriGeometryPoint"===E&&("esriSpatialRelIntersects"===s||"esriSpatialRelContains"===s)){const r=(0,T.Uy)(new G.Z,n,!1,!1);return Promise.resolve(l=>function a(s,n,E,P){return m(s,n,E,P.coords[0],P.coords[1])}(r,!1,!1,l))}if((0,v.oU)(n)&&"esriGeometryMultipoint"===E){const r=(0,T.Uy)(new G.Z,n,!1,!1);if("esriSpatialRelContains"===s)return Promise.resolve(l=>function y(s,n,E,P,t,r){const l=R(t,r),{coords:h,lengths:u}=P;if(!u)return!1;for(let p=0,g=0;p<u.length;p++,g+=l)if(!m(s,n,E,h[g],h[g+1]))return!1;return!0}(r,!1,!1,l,P,t))}if((0,v.YX)(n)&&"esriGeometryPoint"===E&&("esriSpatialRelIntersects"===s||"esriSpatialRelContains"===s))return Promise.resolve(r=>(0,A.aV)(n,(0,B.Op)(E,P,t,r)));if((0,v.YX)(n)&&"esriGeometryMultipoint"===E&&"esriSpatialRelContains"===s)return Promise.resolve(r=>(0,A.lQ)(n,(0,B.Op)(E,P,t,r)));if((0,v.YX)(n)&&"esriSpatialRelIntersects"===s){const r=function w(s){return"mesh"===s?W.h_:(0,W.IY)(s)}(E);return Promise.resolve(l=>r(n,(0,B.Op)(E,P,t,l)))}return function S(){return Promise.all([i.e("default-node_modules_arcgis_core_chunks_geometryEngineBase_js"),i.e("common")]).then(i.bind(i,32825))}().then(r=>{const l=r[L[s]].bind(null,n.spatialReference,n);return h=>l((0,B.Op)(E,P,t,h))})}function C(s,n,E){return F.apply(this,arguments)}function F(){return(F=(0,U.Z)(function*(s,n,E){const{spatialRel:P,geometry:t}=s;if(t){if(!D(P))throw new Z.Z(j,"Unsupported query spatial relationship",{query:s});if((0,O.JY)(t.spatialReference)&&(0,O.JY)(E)){if(!e(t))throw new Z.Z(j,"Unsupported query geometry type",{query:s});if(!o(n))throw new Z.Z(j,"Unsupported layer geometry type",{query:s});if(s.outSR)return(0,M._W)(s.geometry&&s.geometry.spatialReference,s.outSR)}}})).apply(this,arguments)}function K(s){if((0,v.YX)(s))return!0;if((0,v.oU)(s)){for(const n of s.rings)if(5!==n.length||n[0][0]!==n[1][0]||n[0][0]!==n[4][0]||n[2][0]!==n[3][0]||n[0][1]!==n[3][1]||n[0][1]!==n[4][1]||n[1][1]!==n[2][1])return!1;return!0}return!1}},76530:(Q,N,i)=>{function U(v,O){if(!v)return null;const R=O.featureAdapter,{startTimeField:a,endTimeField:y}=v;let m=Number.POSITIVE_INFINITY,I=Number.NEGATIVE_INFINITY;if(a&&y)O.forEach(T=>{const G=R.getAttribute(T,a),M=R.getAttribute(T,y);null==G||isNaN(G)||(m=Math.min(m,G)),null==M||isNaN(M)||(I=Math.max(I,M))});else{const T=a||y;O.forEach(G=>{const M=R.getAttribute(G,T);null==M||isNaN(M)||(m=Math.min(m,M),I=Math.max(I,M))})}return{start:m,end:I}}function Z(v,O,R){if(!O||!v)return null;const{startTimeField:a,endTimeField:y}=v;if(!a&&!y)return null;const{start:m,end:I}=O;return null===m&&null===I?null:void 0===m&&void 0===I?()=>!1:a&&y?function A(v,O,R,a,y){return null!=a&&null!=y?m=>{const I=v.getAttribute(m,O),T=v.getAttribute(m,R);return(null==I||I<=y)&&(null==T||T>=a)}:null!=a?m=>{const I=v.getAttribute(m,R);return null==I||I>=a}:null!=y?m=>{const I=v.getAttribute(m,O);return null==I||I<=y}:void 0}(R,a,y,m,I):function W(v,O,R,a){return null!=R&&null!=a&&R===a?y=>v.getAttribute(y,O)===R:null!=R&&null!=a?y=>{const m=v.getAttribute(y,O);return m>=R&&m<=a}:null!=R?y=>v.getAttribute(y,O)>=R:null!=a?y=>v.getAttribute(y,O)<=a:void 0}(R,a||y,m,I)}i.d(N,{R:()=>U,y:()=>Z})},6185:(Q,N,i)=>{i.d(N,{EG:()=>L,Op:()=>D,S2:()=>n,Up:()=>e,j6:()=>S,vF:()=>T});var U=i(15861),Z=i(2076),A=i(62208),W=i(16730),w=i(15176),v=i(91179),O=i(13924),R=i(37053),a=i(82054),y=i(88071),m=i(82959);const I=new Z.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),T=Object.freeze({}),G=new y.Z,M=new y.Z,B=new y.Z,j={esriGeometryPoint:a.fQ,esriGeometryPolyline:a.J6,esriGeometryPolygon:a.eG,esriGeometryMultipoint:a.Iv};function L(t,r,l,h=t.hasZ,u=t.hasM){if((0,A.Wi)(r))return null;const p=t.hasZ&&h,g=t.hasM&&u;if(l){const f=(0,a.Nh)(B,r,t.hasZ,t.hasM,"esriGeometryPoint",l,h,u);return(0,a.fQ)(f,p,g)}return(0,a.fQ)(r,p,g)}function D(t,r,l,h,u,p,g=r,f=l){const x=r&&g,z=l&&f,b=(0,A.pC)(h)?"coords"in h?h:h.geometry:null;if((0,A.Wi)(b))return null;if(u){let J=(0,a.zj)(M,b,r,l,t,u,g,f);return p&&(J=(0,a.Nh)(B,J,x,z,t,p)),j[t](J,x,z)}if(p){const J=(0,a.Nh)(B,b,r,l,t,p,g,f);return j[t](J,x,z)}return(0,a.hY)(G,b,r,l,g,f),j[t](G,x,z)}function e(t,r,l){return o.apply(this,arguments)}function o(){return(o=(0,U.Z)(function*(t,r,l){const{outFields:h,orderByFields:u,groupByFieldsForStatistics:p,outStatistics:g}=t;if(h)for(let f=0;f<h.length;f++)h[f]=h[f].trim();if(u)for(let f=0;f<u.length;f++)u[f]=u[f].trim();if(p)for(let f=0;f<p.length;f++)p[f]=p[f].trim();if(g)for(let f=0;f<g.length;f++)g[f].onStatisticField&&(g[f].onStatisticField=g[f].onStatisticField.trim());return t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),S(t,r,l)})).apply(this,arguments)}function S(t,r,l){return _.apply(this,arguments)}function _(){return(_=(0,U.Z)(function*(t,r,l){if(!t)return null;let{where:h}=t;if(t.where=h=h&&h.trim(),(!h||/^1 *= *1$/.test(h)||r&&r===h)&&(t.where=null),!t.geometry)return t;let u=yield C(t);if(t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel){const{spatialReference:x}=t.geometry;u=(0,w.aO)(u),u.spatialReference=x}t.geometry=u,yield(0,m._W)(u.spatialReference,l);const p=(yield(0,O.aX)((0,v.im)(u)))[0];if((0,A.Wi)(p))throw T;const g=p.toJSON(),f=yield(0,m.iV)(g,g.spatialReference,l);if(!f)throw T;return f.spatialReference=l,t.geometry=f,t})).apply(this,arguments)}function C(t){return F.apply(this,arguments)}function F(){return(F=(0,U.Z)(function*(t){const{geometry:r,distance:l,units:h}=t;if(null==l||"vertexAttributes"in r)return r;const u=r.spatialReference,p=h?I.fromJSON(h):(0,W.qE)(u),g=u&&((0,R.sT)(u)||(0,R.sS)(u))?r:yield(0,m._W)(u,R.Zn).then(()=>(0,m.iV)(r,R.Zn));return(yield K())(g.spatialReference,g,l,p)})).apply(this,arguments)}function K(){return s.apply(this,arguments)}function s(){return(s=(0,U.Z)(function*(){return(yield Promise.all([i.e("default-node_modules_arcgis_core_chunks_geometryEngineBase_js"),i.e("common")]).then(i.bind(i,32825))).geodesicBuffer})).apply(this,arguments)}function n(t){return t&&E in t?JSON.parse(JSON.stringify(t,P)):t}const E="_geVersion",P=(t,r)=>t!==E?r:void 0},8967:(Q,N,i)=>{i.r(N),i.d(N,{default:()=>V});var U=i(15861),Z=i(26584),A=i(63290),W=i(62208),w=i(65401),v=i(32442),O=i(53023),R=i(76530),a=i(6185),y=i(84952),m=i(55746);const I=A.Z.getLogger("esri.views.2d.layers.features.support.whereUtils"),T={getAttribute:(D,e)=>D.field(e)};function M(){return(M=(0,U.Z)(function*(D,e){const o=yield i.e("default-node_modules_arcgis_core_core_sql_WhereClause_js").then(i.bind(i,10410));try{const S=o.WhereClause.create(D,e);if(!S.isStandardized){const _=new Z.Z("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",S);I.error(_)}return _=>{const C=_.readArcadeFeature();return S.testFeature(C,T)}}catch(S){return I.warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",D),_=>!0}})).apply(this,arguments)}const B=A.Z.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter");class V{constructor(e){this._geometryBounds=(0,w.Ue)(),this._idToVisibility=new Map,this._serviceInfo=e}get hash(){return this._hash}check(e){return this._applyFilter(e)}clear(){const e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}}invalidate(){this._idToVisibility.forEach((e,o)=>{this._idToVisibility.set(o,0)})}setKnownIds(e){for(const o of e)this._idToVisibility.set(o,1)}setTrue(e){const o=[],S=[],_=new Set(e);return this._idToVisibility.forEach((C,F)=>{const K=!!(1&this._idToVisibility.get(F)),s=_.has(F);!K&&s?o.push(F):K&&!s&&S.push(F),this._idToVisibility.set(F,s?3:0)}),{show:o,hide:S}}createQuery(){const{geometry:e,spatialRel:o,where:S,timeExtent:_,objectIds:C}=this;return y.Z.fromJSON({geometry:e,spatialRel:o,where:S,timeExtent:_,objectIds:C})}update(e,o){var S=this;return(0,U.Z)(function*(){S._hash=JSON.stringify(e);const _=yield(0,a.j6)(e,null,o);yield Promise.all([S._setGeometryFilter(_),S._setIdFilter(_),S._setAttributeFilter(_),S._setTimeFilter(_)])})()}_setAttributeFilter(e){var o=this;return(0,U.Z)(function*(){if(!e||!e.where)return o._clause=null,void(o.where=null);o._clause=yield function G(D,e){return M.apply(this,arguments)}(e.where,o._serviceInfo.fieldsIndex),o.where=e.where})()}_setIdFilter(e){this._idsToShow=e&&e.objectIds&&new Set(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new Set(e.hiddenIds),this.objectIds=e&&e.objectIds}_setGeometryFilter(e){var o=this;return(0,U.Z)(function*(){if(!e||!e.geometry)return o._spatialQueryOperator=null,o.geometry=null,void(o.spatialRel=null);const S=e.geometry,_=e.spatialRel||"esriSpatialRelIntersects",C=yield(0,O.cW)(_,S,o._serviceInfo.geometryType,o._serviceInfo.hasZ,o._serviceInfo.hasM);(0,v.$P)(o._geometryBounds,S),o._spatialQueryOperator=C,o.geometry=S,o.spatialRel=_})()}_setTimeFilter(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=e.timeExtent,this._timeOperator=(0,R.y)(this._serviceInfo.timeInfo,e.timeExtent,m.k);else{const o=new Z.Z("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);B.error(o)}}_applyFilter(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)}_filterByExpression(e){return!this.where||this._clause(e)}_filterById(e){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(e.getObjectId()))}_filterByGeometry(e){if(!this.geometry)return!0;const o=e.readHydratedGeometry();return!!o&&this._spatialQueryOperator(o)}_filterByTime(e){return!!(0,W.Wi)(this._timeOperator)||this._timeOperator(e)}_resetAllHiddenIds(){const e=[];return this._idToVisibility.forEach((o,S)=>{1&o||(this._idToVisibility.set(S,1),e.push(S))}),e}}}}]);