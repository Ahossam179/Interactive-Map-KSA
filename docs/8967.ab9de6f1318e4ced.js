"use strict";(self.webpackChunkdemo2=self.webpackChunkdemo2||[]).push([[8967],{53023:(Q,C,i)=>{i.d(C,{hN:()=>K,P0:()=>N,cW:()=>O});var G=i(15861),_=i(26584),F=i(33190),W=i(11519),v=i(91179),P=i(37053);function R(s,n){return s?n?4:3:n?3:2}function y(s,n,E,T,t){if(!s)return!1;const r=R(n,E),{coords:l,lengths:h}=s;let u=!1,p=0;for(const g of h)u=I(u,l,r,p,g,T,t),p+=g*r;return u}function I(s,n,E,T,t,r,l){let h=s,u=T;for(let p=T,g=T+t*E;p<g;p+=E){u=p+E,u===g&&(u=T);const f=n[p],Z=n[p+1],z=n[u],b=n[u+1];(Z<l&&b>=l||b<l&&Z>=l)&&f+(l-Z)/(b-Z)*(z-f)<r&&(h=!h)}return h}var M=i(82054),j=i(88071),U=i(82959),D=i(6185);const A="feature-store:unsupported-query",w={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},V_spatialRelationship={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},V_queryGeometry={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},V_layerGeometry={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function B(s){return!0===V_spatialRelationship[s]}function e(s){return!0===V_queryGeometry[(0,v.Ji)(s)]}function o(s){return!0===V_layerGeometry[s]}function O(s,n,E,T,t){if((0,v.oU)(n)&&"esriGeometryPoint"===E&&("esriSpatialRelIntersects"===s||"esriSpatialRelContains"===s)){const r=(0,M.Uy)(new j.Z,n,!1,!1);return Promise.resolve(l=>function a(s,n,E,T){return y(s,n,E,T.coords[0],T.coords[1])}(r,!1,!1,l))}if((0,v.oU)(n)&&"esriGeometryMultipoint"===E){const r=(0,M.Uy)(new j.Z,n,!1,!1);if("esriSpatialRelContains"===s)return Promise.resolve(l=>function m(s,n,E,T,t,r){const l=R(t,r),{coords:h,lengths:u}=T;if(!u)return!1;for(let p=0,g=0;p<u.length;p++,g+=l)if(!y(s,n,E,h[g],h[g+1]))return!1;return!0}(r,!1,!1,l,T,t))}if((0,v.YX)(n)&&"esriGeometryPoint"===E&&("esriSpatialRelIntersects"===s||"esriSpatialRelContains"===s))return Promise.resolve(r=>(0,F.aV)(n,(0,D.Op)(E,T,t,r)));if((0,v.YX)(n)&&"esriGeometryMultipoint"===E&&"esriSpatialRelContains"===s)return Promise.resolve(r=>(0,F.lQ)(n,(0,D.Op)(E,T,t,r)));if((0,v.YX)(n)&&"esriSpatialRelIntersects"===s){const r=function L(s){return"mesh"===s?W.h_:(0,W.IY)(s)}(E);return Promise.resolve(l=>r(n,(0,D.Op)(E,T,t,l)))}return function S(){return Promise.all([i.e(4918),i.e(8592)]).then(i.bind(i,32825))}().then(r=>{const l=r[w[s]].bind(null,n.spatialReference,n);return h=>l((0,D.Op)(E,T,t,h))})}function N(s,n,E){return x.apply(this,arguments)}function x(){return(x=(0,G.Z)(function*(s,n,E){const{spatialRel:T,geometry:t}=s;if(t){if(!B(T))throw new _.Z(A,"Unsupported query spatial relationship",{query:s});if((0,P.JY)(t.spatialReference)&&(0,P.JY)(E)){if(!e(t))throw new _.Z(A,"Unsupported query geometry type",{query:s});if(!o(n))throw new _.Z(A,"Unsupported layer geometry type",{query:s});if(s.outSR)return(0,U._W)(s.geometry&&s.geometry.spatialReference,s.outSR)}}})).apply(this,arguments)}function K(s){if((0,v.YX)(s))return!0;if((0,v.oU)(s)){for(const n of s.rings)if(5!==n.length||n[0][0]!==n[1][0]||n[0][0]!==n[4][0]||n[2][0]!==n[3][0]||n[0][1]!==n[3][1]||n[0][1]!==n[4][1]||n[1][1]!==n[2][1])return!1;return!0}return!1}},76530:(Q,C,i)=>{function G(v,P){if(!v)return null;const R=P.featureAdapter,{startTimeField:a,endTimeField:m}=v;let y=Number.POSITIVE_INFINITY,I=Number.NEGATIVE_INFINITY;if(a&&m)P.forEach(M=>{const j=R.getAttribute(M,a),U=R.getAttribute(M,m);null==j||isNaN(j)||(y=Math.min(y,j)),null==U||isNaN(U)||(I=Math.max(I,U))});else{const M=a||m;P.forEach(j=>{const U=R.getAttribute(j,M);null==U||isNaN(U)||(y=Math.min(y,U),I=Math.max(I,U))})}return{start:y,end:I}}function _(v,P,R){if(!P||!v)return null;const{startTimeField:a,endTimeField:m}=v;if(!a&&!m)return null;const{start:y,end:I}=P;return null===y&&null===I?null:void 0===y&&void 0===I?()=>!1:a&&m?function F(v,P,R,a,m){return null!=a&&null!=m?y=>{const I=v.getAttribute(y,P),M=v.getAttribute(y,R);return(null==I||I<=m)&&(null==M||M>=a)}:null!=a?y=>{const I=v.getAttribute(y,R);return null==I||I>=a}:null!=m?y=>{const I=v.getAttribute(y,P);return null==I||I<=m}:void 0}(R,a,m,y,I):function W(v,P,R,a){return null!=R&&null!=a&&R===a?m=>v.getAttribute(m,P)===R:null!=R&&null!=a?m=>{const y=v.getAttribute(m,P);return y>=R&&y<=a}:null!=R?m=>v.getAttribute(m,P)>=R:null!=a?m=>v.getAttribute(m,P)<=a:void 0}(R,a||m,y,I)}i.d(C,{R:()=>G,y:()=>_})},6185:(Q,C,i)=>{i.d(C,{EG:()=>w,Op:()=>B,S2:()=>n,Up:()=>e,j6:()=>S,vF:()=>M});var G=i(15861),_=i(2076),F=i(62208),W=i(16730),L=i(15176),v=i(91179),P=i(13924),R=i(37053),a=i(82054),m=i(88071),y=i(82959);const I=new _.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),M=Object.freeze({}),j=new m.Z,U=new m.Z,D=new m.Z,A={esriGeometryPoint:a.fQ,esriGeometryPolyline:a.J6,esriGeometryPolygon:a.eG,esriGeometryMultipoint:a.Iv};function w(t,r,l,h=t.hasZ,u=t.hasM){if((0,F.Wi)(r))return null;const p=t.hasZ&&h,g=t.hasM&&u;if(l){const f=(0,a.Nh)(D,r,t.hasZ,t.hasM,"esriGeometryPoint",l,h,u);return(0,a.fQ)(f,p,g)}return(0,a.fQ)(r,p,g)}function B(t,r,l,h,u,p,g=r,f=l){const Z=r&&g,z=l&&f,b=(0,F.pC)(h)?"coords"in h?h:h.geometry:null;if((0,F.Wi)(b))return null;if(u){let J=(0,a.zj)(U,b,r,l,t,u,g,f);return p&&(J=(0,a.Nh)(D,J,Z,z,t,p)),A[t](J,Z,z)}if(p){const J=(0,a.Nh)(D,b,r,l,t,p,g,f);return A[t](J,Z,z)}return(0,a.hY)(j,b,r,l,g,f),A[t](j,Z,z)}function e(t,r,l){return o.apply(this,arguments)}function o(){return(o=(0,G.Z)(function*(t,r,l){const{outFields:h,orderByFields:u,groupByFieldsForStatistics:p,outStatistics:g}=t;if(h)for(let f=0;f<h.length;f++)h[f]=h[f].trim();if(u)for(let f=0;f<u.length;f++)u[f]=u[f].trim();if(p)for(let f=0;f<p.length;f++)p[f]=p[f].trim();if(g)for(let f=0;f<g.length;f++)g[f].onStatisticField&&(g[f].onStatisticField=g[f].onStatisticField.trim());return t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),S(t,r,l)})).apply(this,arguments)}function S(t,r,l){return O.apply(this,arguments)}function O(){return(O=(0,G.Z)(function*(t,r,l){if(!t)return null;let{where:h}=t;if(t.where=h=h&&h.trim(),(!h||/^1 *= *1$/.test(h)||r&&r===h)&&(t.where=null),!t.geometry)return t;let u=yield N(t);if(t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel){const{spatialReference:Z}=t.geometry;u=(0,L.aO)(u),u.spatialReference=Z}t.geometry=u,yield(0,y._W)(u.spatialReference,l);const p=(yield(0,P.aX)((0,v.im)(u)))[0];if((0,F.Wi)(p))throw M;const g=p.toJSON(),f=yield(0,y.iV)(g,g.spatialReference,l);if(!f)throw M;return f.spatialReference=l,t.geometry=f,t})).apply(this,arguments)}function N(t){return x.apply(this,arguments)}function x(){return(x=(0,G.Z)(function*(t){const{geometry:r,distance:l,units:h}=t;if(null==l||"vertexAttributes"in r)return r;const u=r.spatialReference,p=h?I.fromJSON(h):(0,W.qE)(u),g=u&&((0,R.sT)(u)||(0,R.sS)(u))?r:yield(0,y._W)(u,R.Zn).then(()=>(0,y.iV)(r,R.Zn));return(yield K())(g.spatialReference,g,l,p)})).apply(this,arguments)}function K(){return s.apply(this,arguments)}function s(){return(s=(0,G.Z)(function*(){return(yield Promise.all([i.e(4918),i.e(8592)]).then(i.bind(i,32825))).geodesicBuffer})).apply(this,arguments)}function n(t){return t&&E in t?JSON.parse(JSON.stringify(t,T)):t}const E="_geVersion",T=(t,r)=>t!==E?r:void 0},8967:(Q,C,i)=>{i.r(C),i.d(C,{default:()=>V});var G=i(15861),_=i(26584),F=i(63290),W=i(62208),L=i(65401),v=i(32442),P=i(53023),R=i(76530),a=i(6185),m=i(84952),y=i(55746);const I=F.Z.getLogger("esri.views.2d.layers.features.support.whereUtils"),M={getAttribute:(B,e)=>B.field(e)};function U(){return(U=(0,G.Z)(function*(B,e){const o=yield i.e(410).then(i.bind(i,10410));try{const S=o.WhereClause.create(B,e);if(!S.isStandardized){const O=new _.Z("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",S);I.error(O)}return O=>{const N=O.readArcadeFeature();return S.testFeature(N,M)}}catch(S){return I.warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",B),O=>!0}})).apply(this,arguments)}const D=F.Z.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter");class V{constructor(e){this._geometryBounds=(0,L.Ue)(),this._idToVisibility=new Map,this._serviceInfo=e}get hash(){return this._hash}check(e){return this._applyFilter(e)}clear(){const e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}}invalidate(){this._idToVisibility.forEach((e,o)=>{this._idToVisibility.set(o,0)})}setKnownIds(e){for(const o of e)this._idToVisibility.set(o,1)}setTrue(e){const o=[],S=[],O=new Set(e);return this._idToVisibility.forEach((N,x)=>{const K=!!(1&this._idToVisibility.get(x)),s=O.has(x);!K&&s?o.push(x):K&&!s&&S.push(x),this._idToVisibility.set(x,s?3:0)}),{show:o,hide:S}}createQuery(){const{geometry:e,spatialRel:o,where:S,timeExtent:O,objectIds:N}=this;return m.Z.fromJSON({geometry:e,spatialRel:o,where:S,timeExtent:O,objectIds:N})}update(e,o){var S=this;return(0,G.Z)(function*(){S._hash=JSON.stringify(e);const O=yield(0,a.j6)(e,null,o);yield Promise.all([S._setGeometryFilter(O),S._setIdFilter(O),S._setAttributeFilter(O),S._setTimeFilter(O)])})()}_setAttributeFilter(e){var o=this;return(0,G.Z)(function*(){if(!e||!e.where)return o._clause=null,void(o.where=null);o._clause=yield function j(B,e){return U.apply(this,arguments)}(e.where,o._serviceInfo.fieldsIndex),o.where=e.where})()}_setIdFilter(e){this._idsToShow=e&&e.objectIds&&new Set(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new Set(e.hiddenIds),this.objectIds=e&&e.objectIds}_setGeometryFilter(e){var o=this;return(0,G.Z)(function*(){if(!e||!e.geometry)return o._spatialQueryOperator=null,o.geometry=null,void(o.spatialRel=null);const S=e.geometry,O=e.spatialRel||"esriSpatialRelIntersects",N=yield(0,P.cW)(O,S,o._serviceInfo.geometryType,o._serviceInfo.hasZ,o._serviceInfo.hasM);(0,v.$P)(o._geometryBounds,S),o._spatialQueryOperator=N,o.geometry=S,o.spatialRel=O})()}_setTimeFilter(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=e.timeExtent,this._timeOperator=(0,R.y)(this._serviceInfo.timeInfo,e.timeExtent,y.k);else{const o=new _.Z("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);D.error(o)}}_applyFilter(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)}_filterByExpression(e){return!this.where||this._clause(e)}_filterById(e){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(e.getObjectId()))}_filterByGeometry(e){if(!this.geometry)return!0;const o=e.readHydratedGeometry();return!!o&&this._spatialQueryOperator(o)}_filterByTime(e){return!!(0,W.Wi)(this._timeOperator)||this._timeOperator(e)}_resetAllHiddenIds(){const e=[];return this._idToVisibility.forEach((o,S)=>{1&o||(this._idToVisibility.set(S,1),e.push(S))}),e}}}}]);