"use strict";(self.webpackChunkdemo2=self.webpackChunkdemo2||[]).push([["default-node_modules_arcgis_core_views_2d_engine_flow_FlowView2D_js-node_modules_arcgis_core_-0b0887"],{42230:(at,B,n)=>{n.d(B,{Z:()=>Nt});var C=n(15861),p=n(17626),E=n(88879),N=n(80542),w=n(32917),y=n(77712),M=(n(85931),n(8314),n(90912),n(76898)),v=n(62208),S=n(23841);function l(s){return"constant"===s.kind?s.value[0]:s.values[s.values.length-1]}function c(s){const t=s.toRgba();return[t[0]/255,t[1]/255,t[2]/255,t[3]]}function x(s){if(!s.hasVisualVariables("size"))return{kind:"constant",value:[(0,S.F2)(s.trailWidth)]};const t=s.getVisualVariablesForType("size")[0],e=[],a=[];let i;if(t.stops){for(const r of t.stops)e.push(r.value),a.push((0,S.F2)(r.size));i=t.stops.length}else e.push(t.minDataValue,t.maxDataValue),a.push((0,S.F2)(t.minSize),(0,S.F2)(t.maxSize)),i=2;return{kind:"ramp",stops:e,values:a,count:i}}function R(s){if(!s.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const t=s.getVisualVariablesForType("opacity")[0],e=[],a=[];for(const i of t.stops)e.push(i.value),a.push(i.opacity);return{kind:"ramp",stops:e,values:a,count:t.stops.length}}function F(s,t,e,a){switch(t){case"int":s.setUniform1iv(e,a);break;case"float":s.setUniform1fv(e,a);break;case"vec2":s.setUniform2fv(e,a);break;case"vec3":s.setUniform3fv(e,a);break;case"vec4":s.setUniform4fv(e,a)}}function I(s,t,e,a){"constant"===a.kind?F(s,e,`u_${t}`,a.value):(F(s,"float",`u_${t}_stops`,a.stops),F(s,e,`u_${t}_values`,a.values),s.setUniform1i(`u_${t}_count`,a.count))}function st(s,t){return s===t||!(!(0,v.pC)(s)||!(0,v.pC)(t))&&s.equals(t)}function it(s,t){if(!function ot(s,t){let e=!0;return e=e&&s.collisions===t.collisions,e=e&&s.density===t.density,e=e&&s.interpolate===t.interpolate,e=e&&s.lineCollisionWidth===t.lineCollisionWidth,e=e&&s.lineSpacing===t.lineSpacing,e=e&&s.maxTurnAngle===t.maxTurnAngle,e=e&&s.minSpeedThreshold===t.minSpeedThreshold,e=e&&s.segmentLength===t.segmentLength,e=e&&s.smoothing===t.smoothing,e=e&&s.velocityScale===t.velocityScale,e=e&&s.verticesPerLine===t.verticesPerLine,e}(s.simulationSettings,t.simulationSettings)||!st(s.timeExtent,t.timeExtent))return!1;let e=!0;return e=e&&s.loadImagery===t.loadImagery,e=e&&s.createFlowMesh===t.createFlowMesh,e=e&&s.color.kind===t.color.kind,e=e&&s.opacity.kind===t.opacity.kind,e=e&&s.size.kind===t.size.kind,e}var H=n(10699),G=n(83994),d=n(67969),lt=n(55086),X=n(49353),T=n(40852);class J{constructor(t){this._params=t,this.animated=!1}isCompatible(t){if(!(t instanceof J&&st(this._params.timeExtent,t._params.timeExtent)))return!1;let e=!0;return e=e&&this._params.loadImagery===t._params.loadImagery,e=e&&this._params.color.kind===t._params.color.kind,e=e&&this._params.opacity.kind===t._params.opacity.kind,e}load(t,e){var a=this;return(0,C.Z)(function*(){const{extent:i,size:r}=t;(0,H.k_)(e);const o=yield a._params.loadImagery(i,r[0],r[1],a._params.timeExtent,e);return new ct(o,{color:a._params.color,opacity:a._params.opacity})})()}render(t,e,a){const{context:i}=t,{program:r}=a;i.setFaceCullingEnabled(!1),i.setBlendingEnabled(!0),i.setBlendFunction(d.zi.ONE,d.zi.ONE_MINUS_SRC_ALPHA),i.useProgram(r),r.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3),i.bindTexture(a.texture,0),r.setUniform1i("u_texture",0),r.setUniform1f("u_Min",a.min),r.setUniform1f("u_Max",a.max),I(r,"color","vec4",this._params.color),I(r,"opacity","float",this._params.opacity),i.bindVAO(a.vertexArray),i.drawArrays(d.MX.TRIANGLE_STRIP,0,4)}}const Y=new Map;Y.set("a_position",0),Y.set("a_texcoord",1);const dt={geometry:[new T.G("a_position",2,d.g.UNSIGNED_SHORT,0,8),new T.G("a_texcoord",2,d.g.UNSIGNED_SHORT,4,8)]},ht={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:Y};class ct{constructor(t,e){this._flowData=t,this._values=e}attach(t){const{context:e}=t,{width:a,height:i}=this._flowData,r=G.f.createVertex(e,d.l1.STATIC_DRAW,new Uint16Array([0,0,0,1,a,0,1,1,0,i,0,0,a,i,1,0])),o=new X.U(e,Y,dt,{geometry:r}),h=[];"ramp"===this._values.color.kind&&h.push("vvColor"),"ramp"===this._values.opacity.kind&&h.push("vvOpacity");const u=t.painter.materialManager.getProgram(ht,h);let D=1e6,W=-1e6;for(let f=0;f<i;f++)for(let _=0;_<a;_++)if(0!==this._flowData.mask[f*a+_]){const K=this._flowData.data[2*(f*a+_)+0],k=this._flowData.data[2*(f*a+_)+1],$=Math.sqrt(K*K+k*k);D=Math.min(D,$),W=Math.max(W,$)}const U=new Uint8Array(4*a*i);for(let f=0;f<i;f++)for(let _=0;_<a;_++)if(0!==this._flowData.mask[f*a+_]){const K=this._flowData.data[2*(f*a+_)+0],k=this._flowData.data[2*(f*a+_)+1],$=(Math.sqrt(K*K+k*k)-D)/(W-D);U[4*(f*a+_)+0]=255*$,U[4*(f*a+_)+1]=0,U[4*(f*a+_)+2]=0,U[4*(f*a+_)+3]=255}else U[4*(f*a+_)+0]=0,U[4*(f*a+_)+1]=0,U[4*(f*a+_)+2]=0,U[4*(f*a+_)+3]=0;const Gt=new lt.x(e,{pixelFormat:d.VI.RGBA,internalFormat:d.VI.RGBA,samplingMode:d.cw.LINEAR,dataType:d.Br.UNSIGNED_BYTE,wrapMode:d.e8.CLAMP_TO_EDGE,flipped:!0,width:a,height:i},U);this.vertexArray=o,this.program=u,this.texture=Gt,this.min=D,this.max=W,this._flowData=null}detach(){this.vertexArray.dispose(),this.texture.dispose()}get ready(){return this.program.isCompiled}}class Q{constructor(t){this._params=t}get animated(){return this._params.flowSpeed>0}isCompatible(t){return t instanceof Q&&it(this._params,t._params)}load(t,e){var a=this;return(0,C.Z)(function*(){const{extent:i,size:r}=t;(0,H.k_)(e);const o=yield a._params.loadImagery(i,r[0],r[1],a._params.timeExtent,e),{vertexData:h,indexData:u}=yield a._params.createFlowMesh("Particles",a._params.simulationSettings,o,e);return new pt(h,u,{color:a._params.color,opacity:a._params.opacity,size:a._params.size})})()}render(t,e,a){const{context:i}=t,{program:r}=a;i.setFaceCullingEnabled(!1),i.setBlendingEnabled(!0),i.setBlendFunction(d.zi.ONE,d.zi.ONE_MINUS_SRC_ALPHA),i.useProgram(r),r.setUniform1f("u_time",e.time),r.setUniform1f("u_trailLength",this._params.trailLength),r.setUniform1f("u_flowSpeed",this._params.flowSpeed),r.setUniform1f("u_featheringSize",this._params.featheringSize),r.setUniform1f("u_featheringOffset",this._params.featheringOffset),r.setUniform1f("u_introFade",this._params.introFade?1:0),r.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),r.setUniform1f("u_decayRate",this._params.decayRate),r.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3),r.setUniformMatrix3fv("u_displayViewMat3",e.displayViewMat3),I(r,"color","vec4",this._params.color),I(r,"opacity","float",this._params.opacity),I(r,"size","float",this._params.size),i.bindVAO(a.vertexArray),i.drawElements(d.MX.TRIANGLES,a.indexCount,d.g.UNSIGNED_INT,0)}}const V=new Map;V.set("a_xyts0",0),V.set("a_xyts1",1),V.set("a_typeIdDurationSeed",2),V.set("a_extrudeInfo",3);const ut={geometry:[new T.G("a_xyts0",4,d.g.FLOAT,0,64),new T.G("a_xyts1",4,d.g.FLOAT,16,64),new T.G("a_typeIdDurationSeed",4,d.g.FLOAT,32,64),new T.G("a_extrudeInfo",4,d.g.FLOAT,48,64)]},mt={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:V};class pt{constructor(t,e,a){this._vertexData=t,this._indexData=e,this._values=a}attach(t){const{context:e}=t,a=G.f.createVertex(e,d.l1.STATIC_DRAW,this._vertexData),i=G.f.createIndex(e,d.l1.STATIC_DRAW,this._indexData),r=new X.U(e,V,ut,{geometry:a},i),o=[];"ramp"===this._values.color.kind&&o.push("vvColor"),"ramp"===this._values.opacity.kind&&o.push("vvOpacity"),"ramp"===this._values.size.kind&&o.push("vvSize");const h=t.painter.materialManager.getProgram(mt,o);this.vertexArray=r,this.program=h,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.isCompiled}}class q{constructor(t){this._styles=t}get animated(){return this._styles.reduce((t,e)=>t||e.animated,!1)}isCompatible(t){if(!(t instanceof q)||this._styles.length!==t._styles.length)return!1;const e=this._styles.length;for(let a=0;a<e;a++)if(!this._styles[a].isCompatible(t._styles[a]))return!1;return!0}load(t,e){var a=this;return(0,C.Z)(function*(){const i=yield Promise.all(a._styles.map(r=>r.load(t,e)));return new ft(i)})()}render(t,e,a){for(let i=0;i<this._styles.length;i++)this._styles[i].render(t,e,a.resources[i])}}class ft{constructor(t){this.resources=t}attach(t){for(const e of this.resources)e.attach(t)}detach(){for(const t of this.resources)t.detach()}get ready(){return this.resources.reduce((t,e)=>t&&e.ready,!0)}}class tt{constructor(t){this._params=t}get animated(){return this._params.flowSpeed>0}isCompatible(t){return t instanceof tt&&it(this._params,t._params)}load(t,e){var a=this;return(0,C.Z)(function*(){const{extent:i,size:r}=t;(0,H.k_)(e);const o=yield a._params.loadImagery(i,r[0],r[1],a._params.timeExtent,e),{vertexData:h,indexData:u}=yield a._params.createFlowMesh("Streamlines",a._params.simulationSettings,o,e);return new gt(h,u,{color:a._params.color,opacity:a._params.opacity,size:a._params.size})})()}render(t,e,a){const{context:i}=t,{program:r}=a;i.setFaceCullingEnabled(!1),i.setBlendingEnabled(!0),i.setBlendFunction(d.zi.ONE,d.zi.ONE_MINUS_SRC_ALPHA),i.useProgram(r),r.setUniform1f("u_time",e.time),r.setUniform1f("u_trailLength",this._params.trailLength),r.setUniform1f("u_flowSpeed",this._params.flowSpeed),r.setUniform1f("u_featheringSize",this._params.featheringSize),r.setUniform1f("u_featheringOffset",this._params.featheringOffset),r.setUniform1f("u_introFade",this._params.introFade?1:0),r.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),r.setUniform1f("u_decayRate",this._params.decayRate),r.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3),r.setUniformMatrix3fv("u_displayViewMat3",e.displayViewMat3),I(r,"color","vec4",this._params.color),I(r,"opacity","float",this._params.opacity),I(r,"size","float",this._params.size),i.bindVAO(a.vertexArray),i.drawElements(d.MX.TRIANGLES,a.indexCount,d.g.UNSIGNED_INT,0)}}const L=new Map;L.set("a_positionAndSide",0),L.set("a_timeInfo",1),L.set("a_extrude",2),L.set("a_speed",3);const _t={geometry:[new T.G("a_positionAndSide",3,d.g.FLOAT,0,36),new T.G("a_timeInfo",3,d.g.FLOAT,12,36),new T.G("a_extrude",2,d.g.FLOAT,24,36),new T.G("a_speed",1,d.g.FLOAT,32,36)]},yt={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:L};class gt{constructor(t,e,a){this._vertexData=t,this._indexData=e,this._values=a}attach(t){const{context:e}=t,a=G.f.createVertex(e,d.l1.STATIC_DRAW,this._vertexData),i=G.f.createIndex(e,d.l1.STATIC_DRAW,this._indexData),r=new X.U(e,L,_t,{geometry:a},i),o=[];"ramp"===this._values.color.kind&&o.push("vvColor"),"ramp"===this._values.opacity.kind&&o.push("vvOpacity"),"ramp"===this._values.size.kind&&o.push("vvSize");const h=t.painter.materialManager.getProgram(yt,o);this.vertexArray=r,this.program=h,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.isCompiled}}var rt=n(37084),Ot=n(18717),Ct=n(39406),Mt=n(44589);class Ft extends Mt.Z{constructor(){super(...arguments),this.flowStyle=null}get requiresDedicatedFBO(){return!1}doRender(t){super.doRender(t)}prepareRenderPasses(t){const e=t.registerRenderPass({name:"flow",brushes:[Ot.Z],target:()=>this.children,drawPhase:Ct.jx.MAP});return[...super.prepareRenderPasses(t),e]}}n(29132);var It=n(14517),nt=n(63290),et=n(21286),Tt=n(49672);const Pt=nt.Z.getLogger("esri.views.2d.engine.flow.FlowDisplayData");class Rt{constructor(t,e,a,i){this.state={name:"created"},this.flowStyle=t,this.extent=e,this.size=a,this.pixelRatio=i}load(){var t=this;return(0,C.Z)(function*(){const e=new AbortController;t.state={name:"loading",abortController:e};const a={extent:t.extent,size:t.size,pixelRatio:t.pixelRatio},i=yield t.flowStyle.load(a,e.signal);t.state={name:"loaded",resources:i}})()}attach(t){if("loaded"!==this.state.name)return void Pt.error("Only loaded resources can be attached.");const e=this.state.resources;e.attach(t),this.state={name:"attached",resources:e}}detach(){if("loading"===this.state.name)return this.state.abortController.abort(),void(this.state={name:"detached"});"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})}update(t){return!!this.flowStyle.isCompatible(t.flowStyle)&&!(!this.extent.equals(t.extent)||this.size[0]!==t.size[0]||this.size[1]!==t.size[1]||this.pixelRatio!==t.pixelRatio||(this.flowStyle=t.flowStyle,0))}}var Z=n(30217),Ut=n(49966),bt=n(57477);class zt extends bt.s{constructor(){super(...arguments),this._displayData=null}get displayData(){return this._displayData}set displayData(t){this._displayData=t,this.requestRender()}clear(){(0,v.pC)(this._displayData)&&(this._displayData.detach(),this._displayData=null,this.requestRender())}setTransform(t){const{displayData:e}=this;if((0,v.Wi)(e))return;const r=[0,0];t.toScreen(r,[e.extent.xmin,e.extent.ymax]);const o=(e.extent.xmax-e.extent.xmin)/e.size[0]/t.resolution,h=(0,et.Vl)(t.rotation),{dvs:u}=this.transforms;(0,Z.h)(u,[-1,1,0]),(0,Z.d)(u,u,[2/(t.size[0]*t.pixelRatio),-2/(t.size[1]*t.pixelRatio),1]),(0,Z.c)(u,u,[r[0],r[1],0]),(0,Z.r)(u,u,h),(0,Z.d)(u,u,[o*t.pixelRatio,o*t.pixelRatio,1])}_createTransforms(){return{dvs:(0,Ut.c)()}}}var Vt=n(2004);const jt=nt.Z.getLogger("esri.views.2d.engine.flow.FlowStrategy");let j=class extends It.Z{constructor(s){super(s),this._flowDisplayObject=new zt,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(s){const{flowStyle:t}=this.flowContainer;if((0,v.Wi)(t))return void this._clear();const{extent:e,rotation:a,resolution:i,pixelRatio:r}=s.state,o=function Bt(s,t){const e=new Tt.Z({x:(s.xmax+s.xmin)/2,y:(s.ymax+s.ymin)/2,spatialReference:s.spatialReference}),a=s.xmax-s.xmin,i=s.ymax-s.ymin,r=Math.abs(Math.cos((0,et.Vl)(t))),o=Math.abs(Math.sin((0,et.Vl)(t))),h=r*a+o*i,u=o*a+r*i,D=new Vt.Z({xmin:e.x-h/2,ymin:e.y-u/2,xmax:e.x+h/2,ymax:e.y+u/2,spatialReference:s.spatialReference});return D.centerAt(e),D}(e,a);o.expand(1.15);const h=[Math.round((o.xmax-o.xmin)/i),Math.round((o.ymax-o.ymin)/i)],u=new Rt(t,o,h,r);if((0,v.pC)(this._loading)){if(this._loading.update(u))return;this._loading.detach(),this._loading=null}!(0,v.Wi)(this._flowDisplayObject.displayData)&&this._flowDisplayObject.displayData.update(u)||(u.load().then(()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null},D=>{(0,H.D_)(D)||(jt.error("A resource failed to load.",D),this._loading=null)}),this._loading=u)}_clear(){this._flowDisplayObject.clear(),(0,v.pC)(this._loading)&&(this._loading.detach(),this._loading=null)}};(0,p._)([(0,y.Cb)()],j.prototype,"_loading",void 0),(0,p._)([(0,y.Cb)()],j.prototype,"flowContainer",void 0),(0,p._)([(0,y.Cb)()],j.prototype,"updating",null),j=(0,p._)([(0,M.j)("esri.views.2d.engine.flow.FlowStrategy")],j);const Wt=j;let O=class extends N.r{constructor(){var s;super(...arguments),s=this,this._loadImagery=(t,e,a,i,r)=>(0,rt.KK)(this.layer,t,e,a,i,r),this._createFlowMesh=(t,e,a,i)=>this.layer.createFlowMesh({meshType:t,flowData:a,simulationSettings:e},{signal:i}),this.attached=!1,this.container=null,this.layer=null,this.type="flow",this.timeExtent=null,this.redrawOrRefetch=(0,C.Z)(function*(){s._updateVisualization()})}get updating(){return!this._strategy||this._strategy.updating}attach(){const{layer:s}=this,t=()=>{this._loadImagery=(e,a,i,r,o)=>(0,rt.KK)(s,e,a,i,r,o),this._updateVisualization()};this.handles.add("multidimensionalDefinition"in s?(0,w.YP)(()=>s.multidimensionalDefinition,t):[(0,w.YP)(()=>s.mosaicRule,t),(0,w.YP)(()=>s.renderingRule,t),(0,w.YP)(()=>s.definitionExpression,t)]),this.container=new Ft,this._strategy=new Wt({flowContainer:this.container}),this._updateVisualization()}detach(){this._strategy.destroy(),this.container.removeAllChildren(),this.container=null,this.handles.removeAll()}update(s){s.stationary?this._strategy.update(s):this.layerView.requestUpdate()}hitTest(s){return new E.Z({attributes:{},geometry:s.clone(),layer:this.layer})}moveEnd(){}doRefresh(){return(0,C.Z)(function*(){})()}_updateVisualization(){const{renderer:s}=this.layer;if("flow"!==s.type)return;const t=function St(s,t){const{flowSpeed:e,trailLength:a}=s,i=function b(s){const t=l(x(s)),e=t,i=Math.max(t/2,5),r=Math.round((0,S.F2)(s.maxPathLength)/i)+1,{density:h}=s;return{smoothing:(0,S.F2)(s.smoothing),interpolate:!0,velocityScale:"flow-from"===s.flowRepresentation?1:-1,verticesPerLine:r,minSpeedThreshold:.001,segmentLength:i,maxTurnAngle:1,collisions:!0,lineCollisionWidth:e,lineSpacing:10,density:h}}(s);let r=null;const o={opacity:R(s),size:x(s)};let h=function A(s){if(!s.hasVisualVariables("color"))return{kind:"constant",value:c(s.color)};const t=s.getVisualVariablesForType("color")[0],e=[],a=[];for(const i of t.stops)e.push(i.value),Array.prototype.push.apply(a,c(i.color));return{kind:"ramp",stops:e,values:a,count:t.stops.length}}(s);"none"===s.background?o.color=h:("constant"===h.kind&&(h={kind:"ramp",stops:[0,1],values:[0,0,0,1,h.value[0],h.value[1],h.value[2],h.value[3]],count:2}),r=new J({loadImagery:t.loadImagery,timeExtent:t.timeExtent,color:h,opacity:{kind:"constant",value:[1]}}),o.color={kind:"constant",value:[.1,.1,.1,1]});const u={loadImagery:t.loadImagery,createFlowMesh:t.createFlowMesh,simulationSettings:i,timeExtent:t.timeExtent,trailLength:a,flowSpeed:e,featheringSize:1,featheringOffset:.5,introFade:!0,fadeToZero:!0,decayRate:2.3,color:o.color,opacity:o.opacity,size:o.size},D="butt"===s.trailCap||l(x(s))<=4?new tt(u):new Q(u);return(0,v.pC)(r)?new q([r,D]):D}(s,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent});this.container.flowStyle=t,this.layerView.requestUpdate()}};(0,p._)([(0,y.Cb)()],O.prototype,"_strategy",void 0),(0,p._)([(0,y.Cb)()],O.prototype,"attached",void 0),(0,p._)([(0,y.Cb)()],O.prototype,"container",void 0),(0,p._)([(0,y.Cb)()],O.prototype,"layer",void 0),(0,p._)([(0,y.Cb)()],O.prototype,"layerView",void 0),(0,p._)([(0,y.Cb)()],O.prototype,"type",void 0),(0,p._)([(0,y.Cb)()],O.prototype,"updating",null),(0,p._)([(0,y.Cb)()],O.prototype,"timeExtent",void 0),O=(0,p._)([(0,M.j)("esri.views.2d.engine.flow.FlowView2D")],O);const Nt=O},4102:(at,B,n)=>{n.d(B,{F:()=>S}),n(8314);var p=n(62208),E=n(30217),N=n(49966),w=n(9545),y=n(30994),g=n(57477),P=n(64288),z=n(83994),M=n(67969),v=n(49353);class S extends g.s{constructor(l=null){super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.stencilRef=0,this.resolution=null,this.pixelRatio=1,this.x=0,this.y=0,this.rotation=0,this.rawPixelData=null,this.width=null,this.source=l}destroy(){var l,c;(0,p.pC)(this.vaoData)&&(null==(l=this.vaoData.magdir)||l.vao.dispose(),null==(c=this.vaoData.scalar)||c.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(l){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(l)&&(this._symbolizerParameters=l,this.invalidateVAO())}get source(){return this._source}set source(l){this._source=l,this.invalidateVAO()}invalidateVAO(){var l,c;!this._vaoInvalidated&&(0,p.pC)(this.vaoData)&&(null==(l=this.vaoData.magdir)||l.vao.dispose(),null==(c=this.vaoData.scalar)||c.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(l){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,(0,p.pC)(this.source)&&(0,p.Wi)(this.vaoData)){const{style:c}=this.symbolizerParameters;switch(c){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const m=(0,y.wF)(this.source,this.symbolizerParameters),x=this._createVectorFieldVAO(l.context,m);this.vaoData={magdir:x}}break;case"simple_scalar":{const m=(0,y.K)(this.source,this.symbolizerParameters),x=this._createVectorFieldVAO(l.context,m);this.vaoData={scalar:x}}break;case"wind_speed":{const m=(0,y.wF)(this.source,this.symbolizerParameters),x=this._createVectorFieldVAO(l.context,m),A=(0,y.K)(this.source,this.symbolizerParameters),R=this._createVectorFieldVAO(l.context,A);this.vaoData={magdir:x,scalar:R}}}}this.ready(),this.requestRender()}}_createTransforms(){return{dvs:(0,N.c)()}}setTransform(l){const c=(0,E.b)(this.transforms.dvs),[m,x]=l.toScreenNoRotation([0,0],[this.x,this.y]),A=this.resolution/this.pixelRatio/l.resolution,R=A*this.width,F=A*this.height,I=Math.PI*this.rotation/180;(0,E.c)(c,c,(0,w.f)(m,x)),(0,E.c)(c,c,(0,w.f)(R/2,F/2)),(0,E.r)(c,c,-I),(0,E.c)(c,c,(0,w.f)(-R/2,-F/2)),(0,E.j)(c,c,(0,w.f)(R,F)),(0,E.m)(this.transforms.dvs,l.displayViewMat3,c)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(l,c){const{vertexData:m,indexData:x}=c,A=z.f.createVertex(l,M.l1.STATIC_DRAW,new Float32Array(m)),R=z.f.createIndex(l,M.l1.STATIC_DRAW,new Uint32Array(x)),F=(0,P.cM)("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:M.g.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:M.g.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:M.g.FLOAT,normalized:!1}]});return{vao:new v.U(l,F.attributes,F.bufferLayouts,{geometry:A},R),elementCount:x.length}}}},10023:(at,B,n)=>{n.d(B,{V:()=>y,e:()=>N});var C=n(15861),p=n(62208),E=n(36630);function N(g){return w.apply(this,arguments)}function w(){return(w=(0,C.Z)(function*(g,P=g.popupTemplate){if((0,p.Wi)(P))return[];const z=yield P.getRequiredFields(g.fieldsIndex),{lastEditInfoEnabled:M}=P,{objectIdField:v,typeIdField:S,globalIdField:b,relationships:l}=g;if(z.includes("*"))return["*"];const c=M?yield(0,E.CH)(g):[],m=(0,E.Q0)(g.fieldsIndex,[...z,...c]);return S&&m.push(S),m&&v&&g.fieldsIndex.has(v)&&!m.includes(v)&&m.push(v),m&&b&&g.fieldsIndex.has(b)&&!m.includes(b)&&m.push(b),l&&l.forEach(x=>{const{keyField:A}=x;m&&A&&g.fieldsIndex.has(A)&&!m.includes(A)&&m.push(A)}),m})).apply(this,arguments)}function y(g,P){return g.popupTemplate?g.popupTemplate:(0,p.pC)(P)&&P.defaultPopupTemplateEnabled&&(0,p.pC)(g.defaultPopupTemplate)?g.defaultPopupTemplate:null}}}]);